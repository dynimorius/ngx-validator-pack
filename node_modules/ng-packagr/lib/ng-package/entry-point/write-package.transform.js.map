{"version":3,"file":"write-package.transform.js","sourceRoot":"","sources":["../../../../src/lib/ng-package/entry-point/write-package.transform.ts"],"names":[],"mappings":"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","sourcesContent":["import ora from 'ora';\nimport * as path from 'path';\nimport { AssetPattern } from '../../../ng-package.schema';\nimport { BuildGraph } from '../../graph/build-graph';\nimport { Node } from '../../graph/node';\nimport { transformFromPromise } from '../../graph/transform';\nimport { colors } from '../../utils/color';\nimport { copyFile, exists, readFile, rmdir, stat, writeFile } from '../../utils/fs';\nimport { globFiles } from '../../utils/glob';\nimport * as log from '../../utils/log';\nimport { ensureUnixPath } from '../../utils/path';\nimport { EntryPointNode, PackageNode, fileUrl, isEntryPoint, isEntryPointInProgress, isPackage } from '../nodes';\nimport { NgPackagrOptions } from '../options.di';\nimport { NgPackage } from '../package';\nimport { NgEntryPoint } from './entry-point';\n\ntype CompilationMode = 'partial' | 'full' | undefined;\n\nexport const writePackageTransform = (options: NgPackagrOptions) =>\n  transformFromPromise(async graph => {\n    const spinner = ora({\n      hideCursor: false,\n      discardStdin: false,\n    });\n    const entryPoint: EntryPointNode = graph.find(isEntryPointInProgress());\n    const ngEntryPoint: NgEntryPoint = entryPoint.data.entryPoint;\n    const ngPackageNode: PackageNode = graph.find(isPackage);\n    const ngPackage = ngPackageNode.data;\n    const { destinationFiles } = entryPoint.data;\n\n    if (!ngEntryPoint.isSecondaryEntryPoint) {\n      spinner.start('Copying assets');\n      try {\n        await copyAssets(graph, entryPoint, ngPackageNode);\n      } catch (error) {\n        spinner.fail();\n        throw error;\n      }\n      spinner.succeed();\n    }\n\n    // 6. WRITE PACKAGE.JSON\n    const relativeUnixFromDestPath = (filePath: string) =>\n      ensureUnixPath(path.relative(ngEntryPoint.destinationPath, filePath));\n\n    if (!ngEntryPoint.isSecondaryEntryPoint) {\n      try {\n        spinner.start('Writing package manifest');\n        if (!options.watch) {\n          const primary = ngPackageNode.data.primary;\n          await writeFile(\n            path.join(primary.destinationPath, '.npmignore'),\n            `# Nested package.json's are only needed for development.\\n**/package.json`,\n          );\n        }\n\n        const { compilationMode } = entryPoint.data.tsConfig.options;\n\n        await writePackageJson(\n          ngEntryPoint,\n          ngPackage,\n          {\n            module: relativeUnixFromDestPath(destinationFiles.fesm2022),\n            typings: relativeUnixFromDestPath(destinationFiles.declarations),\n            exports: generatePackageExports(ngEntryPoint, graph),\n            // webpack v4+ specific flag to enable advanced optimizations and code splitting\n            sideEffects: ngEntryPoint.packageJson.sideEffects ?? false,\n          },\n          !!options.watch,\n          compilationMode as CompilationMode,\n          spinner,\n        );\n      } catch (error) {\n        spinner.fail();\n        throw error;\n      }\n      spinner.succeed();\n    } else if (ngEntryPoint.isSecondaryEntryPoint) {\n      if (options.watch) {\n        // Update the watch version of the primary entry point `package.json` file.\n        // this is needed because of Webpack's 5 `cachemanagedpaths`\n        // https://github.com/ng-packagr/ng-packagr/issues/2069\n        const primary = ngPackageNode.data.primary;\n        const packageJsonPath = path.join(primary.destinationPath, 'package.json');\n\n        if (await exists(packageJsonPath)) {\n          const packageJson = JSON.parse(await readFile(packageJsonPath, { encoding: 'utf8' }));\n          packageJson.version = generateWatchVersion();\n          await writeFile(\n            path.join(primary.destinationPath, 'package.json'),\n            JSON.stringify(packageJson, undefined, 2),\n          );\n        }\n      }\n\n      // Write a package.json in each secondary entry-point\n      // This is need for esbuild to secondary entry-points in dist correctly.\n      await writeFile(\n        path.join(ngEntryPoint.destinationPath, 'package.json'),\n        JSON.stringify({ module: relativeUnixFromDestPath(destinationFiles.fesm2022) }, undefined, 2),\n      );\n    }\n\n    spinner.succeed(`Built ${ngEntryPoint.moduleId}`);\n\n    return graph;\n  });\n\ntype AssetEntry = Exclude<AssetPattern, string>;\n\nasync function copyAssets(\n  graph: BuildGraph,\n  entryPointNode: EntryPointNode,\n  ngPackageNode: PackageNode,\n): Promise<void> {\n  const ngPackage = ngPackageNode.data;\n\n  const globsForceIgnored: string[] = ['.gitkeep', '**/.DS_Store', '**/Thumbs.db', `${ngPackage.dest}/**`];\n  const defaultAssets: AssetEntry[] = [\n    { glob: 'LICENSE', input: '/', output: '/' },\n    ...graph.filter(isEntryPoint).map(({ data }) => {\n      const subpath = data.entryPoint.destinationFiles.directory || '/';\n\n      return {\n        glob: 'README.md',\n        input: subpath,\n        output: subpath,\n      };\n    }),\n  ];\n\n  const assets: AssetEntry[] = [];\n\n  for (const assetPath of [...ngPackage.assets, ...defaultAssets]) {\n    let asset: AssetEntry;\n    if (typeof assetPath === 'object') {\n      asset = { ...assetPath };\n    } else {\n      const [isDir, isFile] = await stat(path.join(ngPackage.src, assetPath))\n        .then(stats => [stats.isDirectory(), stats.isFile()])\n        .catch(() => [false, false]);\n      if (isDir) {\n        asset = { glob: '**/*', input: assetPath, output: assetPath };\n      } else if (isFile) {\n        // filenames are their own glob\n        asset = {\n          glob: path.basename(assetPath),\n          input: path.dirname(assetPath),\n          output: path.dirname(assetPath),\n        };\n      } else {\n        asset = { glob: assetPath, input: '/', output: '/' };\n      }\n    }\n\n    asset.input = path.join(ngPackage.src, asset.input);\n    asset.output = path.join(ngPackage.dest, asset.output);\n\n    const isAncestorPath = (target: string, datum: string) => path.relative(datum, target).startsWith('..');\n    if (isAncestorPath(asset.input, ngPackage.src)) {\n      throw new Error('Cannot read assets from a location outside of the project root.');\n    }\n    if (isAncestorPath(asset.output, ngPackage.dest)) {\n      throw new Error('Cannot write assets to a location outside of the output path.');\n    }\n\n    assets.push(asset);\n  }\n\n  for (const asset of assets) {\n    const filePaths = await globFiles(asset.glob, {\n      cwd: asset.input,\n      ignore: [...(asset.ignore ?? []), ...globsForceIgnored],\n      dot: true,\n      onlyFiles: true,\n      followSymbolicLinks: asset.followSymlinks,\n    });\n    for (const filePath of filePaths) {\n      const fileSrcFullPath = path.join(asset.input, filePath);\n      const fileDestFullPath = path.join(asset.output, filePath);\n      const nodeUri = fileUrl(ensureUnixPath(fileSrcFullPath));\n      let node = graph.get(nodeUri);\n      if (!node) {\n        node = new Node(nodeUri);\n        graph.put(node);\n      }\n      entryPointNode.dependsOn(node);\n      await copyFile(fileSrcFullPath, fileDestFullPath);\n    }\n  }\n}\n\n/**\n * Creates and writes a `package.json` file of the entry point used by the `node_module`\n * resolution strategies.\n *\n * #### Example\n *\n * A consumer of the entry point depends on it by `import {..} from '@my/module/id';`.\n * The module id `@my/module/id` will be resolved to the `package.json` file that is written by\n * this build step.\n * The properties `main`, `module`, `typings` (and so on) in the `package.json` point to the\n * flattened JavaScript bundles, type definitions, (...).\n *\n * @param entryPoint An entry point of an Angular package / library\n * @param additionalProperties Additional properties, e.g. binary artefacts (bundle files), to merge into `package.json`\n */\nasync function writePackageJson(\n  entryPoint: NgEntryPoint,\n  pkg: NgPackage,\n  additionalProperties: { [key: string]: string | boolean | string[] | ConditionalExport },\n  isWatchMode: boolean,\n  compilationMode: CompilationMode,\n  spinner: ora.Ora,\n): Promise<void> {\n  log.debug('Writing package.json');\n\n  // set additional properties\n  const packageJson = { ...entryPoint.packageJson, ...additionalProperties };\n\n  // read tslib version from `@angular/compiler` so that our tslib\n  // version at least matches that of angular if we use require('tslib').version\n  // it will get what installed and not the minimum version nor if it is a `~` or `^`\n  // this is only required for primary\n  if (isWatchMode) {\n    // Needed because of Webpack's 5 `cachemanagedpaths`\n    // https://github.com/angular/angular-cli/issues/20962\n    packageJson.version = generateWatchVersion();\n  }\n\n  if (!packageJson.peerDependencies?.tslib && !packageJson.dependencies?.tslib) {\n    const {\n      peerDependencies: angularPeerDependencies = {},\n      dependencies: angularDependencies = {},\n    } = require('@angular/compiler/package.json');\n    const tsLibVersion = angularPeerDependencies.tslib || angularDependencies.tslib;\n\n    if (tsLibVersion) {\n      packageJson.dependencies = {\n        ...packageJson.dependencies,\n        tslib: tsLibVersion,\n      };\n    }\n  } else if (packageJson.peerDependencies?.tslib) {\n    spinner.warn(\n      colors.yellow(\n        `'tslib' is no longer recommended to be used as a 'peerDependencies'. Moving it to 'dependencies'.`,\n      ),\n    );\n    packageJson.dependencies = {\n      ...(packageJson.dependencies || {}),\n      tslib: packageJson.peerDependencies.tslib,\n    };\n\n    delete packageJson.peerDependencies.tslib;\n  }\n\n  // Verify non-peerDependencies as they can easily lead to duplicate installs or version conflicts\n  // in the node_modules folder of an application\n  const allowedList = pkg.allowedNonPeerDependencies.map(value => new RegExp(value));\n  try {\n    checkNonPeerDependencies(packageJson, 'dependencies', allowedList, spinner);\n  } catch (e) {\n    await rmdir(entryPoint.destinationPath, { recursive: true });\n    throw e;\n  }\n\n  // Removes scripts from package.json after build\n  if (packageJson.scripts) {\n    if (pkg.keepLifecycleScripts !== true) {\n      spinner.info(`Removing scripts section in package.json as it's considered a potential security vulnerability.`);\n      delete packageJson.scripts;\n    } else {\n      spinner.warn(\n        colors.yellow(\n          `You enabled keepLifecycleScripts explicitly. The scripts section in package.json will be published to npm.`,\n        ),\n      );\n    }\n  }\n\n  if (compilationMode !== 'partial') {\n    const scripts = packageJson.scripts || (packageJson.scripts = {});\n    scripts.prepublishOnly =\n      'node --eval \"console.error(\\'' +\n      'ERROR: Trying to publish a package that has been compiled by Ivy in full compilation mode. This is not allowed.\\\\n' +\n      'Please delete and rebuild the package with Ivy partial compilation mode, before attempting to publish.\\\\n' +\n      '\\')\" ' +\n      '&& exit 1';\n  }\n\n  // keep the dist package.json clean\n  // this will not throw if ngPackage field does not exist\n  delete packageJson.ngPackage;\n\n  const packageJsonPropertiesToDelete = [\n    'stylelint',\n    'prettier',\n    'browserslist',\n    'devDependencies',\n    'jest',\n    'workspaces',\n    'husky',\n  ];\n\n  for (const prop of packageJsonPropertiesToDelete) {\n    if (prop in packageJson) {\n      delete packageJson[prop];\n      spinner.info(`Removing ${prop} section in package.json.`);\n    }\n  }\n\n  packageJson.name = entryPoint.moduleId;\n  await writeFile(path.join(entryPoint.destinationPath, 'package.json'), JSON.stringify(packageJson, undefined, 2));\n}\n\nfunction checkNonPeerDependencies(\n  packageJson: Record<string, unknown>,\n  property: string,\n  allowed: RegExp[],\n  spinner: ora.Ora,\n) {\n  if (!packageJson[property]) {\n    return;\n  }\n\n  for (const dep of Object.keys(packageJson[property])) {\n    if (allowed.some(regex => regex.test(dep))) {\n      log.debug(`Dependency ${dep} is allowed in '${property}'`);\n    } else {\n      spinner.warn(\n        colors.yellow(\n          `Distributing npm packages with '${property}' is not recommended. Please consider adding ${dep} ` +\n            `to 'peerDependencies' or remove it from '${property}'.`,\n        ),\n      );\n      throw new Error(`Dependency ${dep} must be explicitly allowed using the \"allowedNonPeerDependencies\" option.`);\n    }\n  }\n}\n\ntype PackageExports = Record<string, ConditionalExport>;\n\n/**\n * Type describing the conditional exports descriptor for an entry-point.\n * https://nodejs.org/api/packages.html#packages_conditional_exports\n */\ntype ConditionalExport = {\n  types?: string;\n  esm2022?: string;\n  esm?: string;\n  default?: string;\n};\n\n/**\n * Generates the `package.json` package exports following APF v13.\n * This is supposed to match with: https://github.com/angular/angular/blob/e0667efa6eada64d1fb8b143840689090fc82e52/packages/bazel/src/ng_package/packager.ts#L415.\n */\nfunction generatePackageExports({ destinationPath, packageJson }: NgEntryPoint, graph: BuildGraph): PackageExports {\n  const exports: PackageExports = packageJson.exports ? JSON.parse(JSON.stringify(packageJson.exports)) : {};\n\n  const insertMappingOrError = (subpath: string, mapping: ConditionalExport) => {\n    exports[subpath] ??= {};\n    const subpathExport = exports[subpath];\n\n    // Go through all conditions that should be inserted. If the condition is already\n    // manually set of the subpath export, we throw an error. In general, we allow for\n    // additional conditions to be set. These will always precede the generated ones.\n    for (const conditionName of Object.keys(mapping)) {\n      if (subpathExport[conditionName] !== undefined) {\n        log.warn(\n          `Found a conflicting export condition for \"${subpath}\". The \"${conditionName}\" ` +\n            `condition would be overridden by ng-packagr. Please unset it.`,\n        );\n      }\n\n      // **Note**: The order of the conditions is preserved even though we are setting\n      // the conditions once at a time (the latest assignment will be at the end).\n      subpathExport[conditionName] = mapping[conditionName];\n    }\n  };\n\n  const relativeUnixFromDestPath = (filePath: string) =>\n    './' + ensureUnixPath(path.relative(destinationPath, filePath));\n\n  insertMappingOrError('./package.json', { default: './package.json' });\n\n  const entryPoints = graph.filter(isEntryPoint);\n  for (const entryPoint of entryPoints) {\n    const { destinationFiles, isSecondaryEntryPoint } = entryPoint.data.entryPoint;\n    const subpath = isSecondaryEntryPoint ? `./${destinationFiles.directory}` : '.';\n\n    insertMappingOrError(subpath, {\n      types: relativeUnixFromDestPath(destinationFiles.declarations),\n      esm2022: relativeUnixFromDestPath(destinationFiles.esm2022),\n      esm: relativeUnixFromDestPath(destinationFiles.esm2022),\n      default: relativeUnixFromDestPath(destinationFiles.fesm2022),\n    });\n  }\n\n  return exports;\n}\n\n/**\n * Generates a new version for the package `package.json` when runing in watch mode.\n */\nfunction generateWatchVersion() {\n  return `0.0.0-watch+${Date.now()}`;\n}\n"]}